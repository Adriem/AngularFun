{"name":"Angularfun","tagline":"AngularJS Reference Architecture","body":"[![Build Status](https://secure.travis-ci.org/CaryLandholt/AngularFun.png)](http://travis-ci.org/CaryLandholt/AngularFun)\r\n[![Built with Grunt](https://cdn.gruntjs.com/builtwith.png)](http://gruntjs.com/)\r\n[![Dependency Status](https://david-dm.org/CaryLandholt/AngularFun.png)](https://david-dm.org/CaryLandholt/AngularFun)\r\n# AngularFun\r\n*By [@CaryLandholt](https://twitter.com/carylandholt)*\r\n\r\n## About\r\nAngularFun is an [AngularJS](http://angularjs.org/) large application Reference Architecture.  The intent is to provide a base for creating your own AngularJS applications with minimal boilerplate setup and ceremony.\r\n\r\nSimply follow the patterns and you'll get a complete development workflow, including:\r\n\r\n* file organization\r\n* transpilation of [CoffeeScript](http://coffeescript.org/) files (*if you prefer plain JavaScript, see [JS Love](#js-love)*)\r\n* transpilation of [LESS](http://lesscss.org/) files\r\n* transpilation of [Jade](http://jade-lang.com/) files\r\n* packages retrieved by [Bower](http://bower.io/)\r\n* three build configurations\r\n\t* **build** - compilation with no optimizations\r\n\t* **default** or **dev** - compilation with no optimizations but includes file watching to monitor changes and build changed files on-the-fly\r\n\t* **prod** - compilation with all optimizations, including concatenation and minification of png, JavaScript, CSS, and HTML files.\r\n* full dependency management (file loading and dependency resolution)\r\n* a unit testing strategy\r\n* a server to run the application\r\n\r\n## Prerequisites\r\n* Must have [Git](http://git-scm.com/) installed\r\n* Must have [node.js (at least v0.8.1)](http://nodejs.org/) installed with npm (Node Package Manager)\r\n* Must have [Grunt](http://gruntjs.com/) node package installed globally.  `npm install -g grunt-cli`\r\n\r\n## Install Angular Fun\r\nEnter the following commands in the terminal.\r\n\r\n1. `git clone git://github.com/CaryLandholt/AngularFun.git`\r\n2. `cd AngularFun`\r\n3. `npm install`\r\n\r\n## Compile Angular Fun\r\nYou have options.\r\n\r\n1. `grunt build` - will compile the app preserving individual files (when run, files will be loaded on-demand)\r\n2. `grunt` or `grunt dev` - same as `grunt` but will watch for file changes and recompile on-the-fly\r\n3. `grunt prod` - will compile using optimizations.  This will create one JavaScript file and one CSS file to demonstrate the power of [r.js](http://requirejs.org/docs/optimization.html), the build optimization tool for RequireJS.  And take a look at the index.html file.  Yep - it's minified too.\r\n4. `grunt test` - will compile the app and run all unit tests\r\n\r\n## JS Love\r\nSome of you prefer working with plain old JavaScript.  We've got ya covered.  Simply run the following grunt task.\r\n`grunt jslove` - will transpile all of the CoffeeScript files to JavaScript and throw out the Coffee.\r\n\r\n## Run It\r\n1. Compile the app using one of the above three options.  `grunt` and `grunt dev` will run the web server and open the app in your default browser automatically.\r\n2. `grunt server` - will run the web server and open the app in your default browser.\r\n\r\n## Making Changes\r\n* `grunt` and `grunt dev` will watch for any .coffee, .less, .jade, or .html file changes.  When changes are detected, the files will be linted, compiled, and ready for you to refresh the browser.\r\n\r\n## Running Tests\r\n`grunt test` - Runs unit tests using the [Karma](http://karma-runner.github.io/) Test Runner\r\n\r\n## Commentary\r\nAngularFun is a by-product of my learning AngularJS and became the reference architecture to my day job project, a very large internally and externally-facing application with extensive user interactions.\r\n\r\nI needed something that could support our Architecture Principles, including scale, stability, and maintenance.\r\n\r\nMy background with using [RequireJS](http://requirejs.org/), see the [RequireJS screencasts](http://www.youtube.com/watch?v=VGlDR1QiV3A&list=PLCBD579A7ADB6313A) on my [YouTube channel](http://www.youtube.com/user/carylandholt), enabled me to get up and running with managing many individual files right away.  RequireJS is a terrific dependency management technology.\r\n\r\n### Take 1\r\nHere's an early example controller in CoffeeScript.\r\n\r\n```CoffeeScript\r\ndefine ['controllers/controllers', 'services/gitHubService'], (controllers) ->\r\n\tcontrollers.controller 'gitHubController', ['$scope', '$location', 'gitHubService', ($scope, $location, gitHubService) ->\r\n\t\t$scope.search = (searchTerm) ->\r\n\t\t\t$location.path \"/github/#{searchTerm}\"\r\n\r\n\t\t$scope.onRouteChange = (routeParams) ->\r\n\t\t\t$scope.searchTerm = routeParams.searchTerm\r\n\r\n\t\t\tgitHubService.get $scope.searchTerm\r\n\t\t\t, (repos) ->\r\n\t\t\t\t$scope.repos = repos\r\n\t]\r\n```\r\n\r\nThere are a couple things going on here.  RequireJS is loading controllers/controllers and services/gitHubService and providing a handle to both.\r\nThe controllers module was an early attempt at organizing AngularJS functionality into separate AngularJS modules (i.e. controllers, services, directives, filters, and responseInterceptors).\r\nThis ultimately provided no benefit, so I got rid of them.  They were just noise.\r\n\r\n### Take 2\r\nUsing only one AngularJS module and rewriting the above script without the functionality-specific AngularJS container modules we have:\r\n\r\n```CoffeeScript\r\ndefine ['libs/angular', 'services/gitHubService'], (angular) ->\r\n\tangular.module('app').controller 'gitHubController', ['$scope', '$location', 'gitHubService', ($scope, $location, gitHubService) ->\r\n\t\t$scope.search = (searchTerm) ->\r\n\t\t\t$location.path \"/github/#{searchTerm}\"\r\n\r\n\t\t$scope.onRouteChange = (routeParams) ->\r\n\t\t\t$scope.searchTerm = routeParams.searchTerm\r\n\r\n\t\t\tgitHubService.get $scope.searchTerm\r\n\t\t\t, (repos) ->\r\n\t\t\t\t$scope.repos = repos\r\n\t]\r\n```\r\n\r\nAs you can see, I now had to bring in a reference to libs/angular.  This *was* a dependency for controllers/controllers.\r\n\r\nLet's now focus on the gitHubService dependency.  The file needs to be loaded, of course, but RequireJS doesn't need to provide a handle to it since AngularJS will do that part.  Notice there's no gitHubService parameter in the define callback.\r\n\r\nBut something just didn't sit well with me.  RequireJS will load dependent files and provide a handle to them beautifully; however, AngularJS has its own dependency management system.  But there is a difference.\r\n\r\nAngularJS does not load dependent files, but it will provide a handle to them once they *are* loaded.  RequireJS does both.\r\n\r\nSo the define function is making sure AngularJS is loaded and provides a handle to it, even though it's a global variable.  It also makes sure gitHubService is loaded but doesn't need to provide a handle since the AngularJS dependency management system will do this.\r\n\r\nEven though there is a difference, there is some overlap in responsibility here.  This can be observed with the mere fact that there is a gitHubService dependency referenced in the define function as well as the controller function.  So the developer has to work in the RequireJS world and AngularJS world in the same file.\r\n\r\n### Take 3\r\n\r\nSo I decided to refactor the files and remove RequireJS completely, at least from the individual files.\r\n\r\nNow we have:\r\n\r\n```CoffeeScript\r\nangular.module('app').controller 'gitHubController', ['$scope', '$location', 'gitHubService', ($scope, $location, gitHubService) ->\r\n\t$scope.search = (searchTerm) ->\r\n\t\t$location.path \"/github/#{searchTerm}\"\r\n\r\n\t$scope.onRouteChange = (routeParams) ->\r\n\t\t$scope.searchTerm = routeParams.searchTerm\r\n\r\n\t\tgitHubService.get $scope.searchTerm\r\n\t\t, (repos) ->\r\n\t\t\t$scope.repos = repos\r\n]\r\n```\r\n\r\nTo me, this just feels better.  The file contains only AngularJS business.  Albeit, I did choose to use a single AngularJS application module called **app** and accept the use of the angular global variable.\r\n\r\nSo if we've removed RequireJS from the files, how do we load the files to let AngularJS do its thing?\r\n\r\nI really don't care for including multiple script references in the index.html file, such as:\r\n\r\n```html\r\n<!-- angular must load first -->\r\n<script src=\"/scripts/libs/angular.js\"></script>\r\n\r\n<!-- angular dependencies must load next -->\r\n<script src=\"/scripts/libs/angular-resource.js\"></script>\r\n<script src=\"/scripts/app.js\"></script>\r\n<script src=\"/scripts/services/messageService.js\"></script>\r\n<script src=\"/scripts/services/gitHubService.js\"></script>\r\n<script src=\"/scripts/controllers/gitHubController.js\"></script>\r\n<!-- ... more scripts -->\r\n\r\n<!-- bootstrap must load last -->\r\n<script src=\"/scripts/bootstrap.js\"></script>\r\n```\r\n\r\nAlthough this may be suitable for some, I'm not comfortable with ensuring load order by where the script references are placed (the angular script reference must precede angular-resource, for example).  I prefer to be more prescriptive than that.\r\nAnd we also need to concatenate and minify the scripts for our prod build.  We could grep the script references, concatenate, and then minify.  We could try out [Yeoman](http://yeoman.io/).  This all seemed a bit heavy-handed.\r\n\r\nThis is where the RequireJS [shim](http://requirejs.org/docs/api.html#config-shim) configuration comes in.\r\n\r\nSince we no longer have dependencies referenced in individual files by way of RequireJS, and the multiple script reference idea is unappealing, we can define our dependencies inside our main file using shim.  Notice the dependencies can be referenced in any order.  RequireJS will ensure dependencies are loaded prior to their being required.\r\n\r\n```CoffeeScript\r\nrequire\r\n\tshim:\r\n\t\t'controllers/gitHubController': deps: ['libs/angular', 'app', 'services/gitHubService']\r\n\t\t'libs/angular-resource': deps: ['libs/angular']\r\n\t\t'services/gitHubService': deps: ['libs/angular', 'app', 'libs/angular-resource', 'services/messageService']\r\n\t\t'services/messageService': deps: ['libs/angular', 'app']\r\n\t\t'app': deps: ['libs/angular', 'libs/angular-resource']\r\n\t\t'bootstrap': deps: ['libs/angular', 'app']\r\n\t[\r\n\t\t'require'\r\n\t\t'controllers/gitHubController'\r\n\t], (require) ->\r\n\t\trequire ['bootstrap']\r\n```\r\n\r\nThe bootstrap file is requested within the callback since it must load last.\r\n\r\nNow we only need a single script reference inside index.html.\r\n\r\n```html\r\n<script data-main=\"/scripts/main.js\" src=\"/scripts/libs/require.js\"></script>\r\n```\r\n\r\nSo what about concatenation and minification?\r\n\r\nSince we're only using RequireJS to manage load order, we can leverage the RequireJS optimizer to concatenate and minify too.  And once the files are concatenated and minified to a single file, we no longer need RequireJS.  This is perfect for our prod build.\r\n\r\nWe do, however, need to introduce a condition in index.html to use the non-optimized files or the optimized files based on the build environment.  The build will do it for us.\r\n\r\nHere are the final index.html script references.  Note that the condition will not be part of the final output.\r\n\r\n```html\r\n<% if (config.environment === 'prod') { %>\r\n\t<script src=\"/scripts/scripts.min.js\"></script>\r\n<% } else { %>\r\n\t<script data-main=\"/scripts/main.js\" src=\"/scripts/libs/require.js\"></script>\r\n<% } %>\r\n```\r\n\r\n### Take 4\r\nInspired by [tardyp](https://github.com/tardyp) and his [grunt-requiregen](https://github.com/tardyp/grunt-requiregen) plugin - what if we didn't have to do anything?\r\n\r\nSo that's actually where we are.  The shim file from [Take 3](#take-3) is built for you.\r\n\r\nWhew!\r\n\r\n### Give and Take\r\nAfter many iterations it now feels right.  All [comments and questions](https://github.com/CaryLandholt/AngularFun/issues) and [Pull Requests](https://github.com/CaryLandholt/AngularFun/pulls) are always welcome.  I respond to all.\r\n\r\n### Contributing\r\nIn lieu of a formal styleguide, take care to maintain the existing coding style. Add unit tests for any new or changed functionality. Lint and test your code using grunt.\r\n\r\n#### List of contributors\r\n* [Cary Landholt](https://github.com/CaryLandholt)\r\n* [David Bochenski](https://github.com/Bochenski)\r\n* [Jan Philipp](https://github.com/knalli)\r\n\r\n## To-Do\r\n* Add many more unit tests :(\r\n* Add more documentation :(\r\n* Screencasts :)\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}